rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // ── proof images ──────────────────────────────────────────────────────
    // Path: proofs/{householdId}/{taskId}.jpg
    // Only authenticated users may read/write their own household's proofs.
    // Write enforces: content type must be JPEG, max 200KB (Section 6.2).
    match /proofs/{householdId}/{fileName} {
      allow read: if request.auth != null;

      allow write: if request.auth != null
        && request.resource.contentType == 'image/jpeg'
        && request.resource.size <= 200 * 1024;
    }

    // ── avatar images ─────────────────────────────────────────────────────
    // Path: avatars/{userId}.jpg
    // Users may only write their own avatar; anyone authenticated may read.
    match /avatars/{fileName} {
      allow read: if request.auth != null;

      allow write: if request.auth != null
        && fileName == request.auth.uid + '.jpg'
        && request.resource.contentType == 'image/jpeg'
        && request.resource.size <= 200 * 1024;
    }
  }
}
